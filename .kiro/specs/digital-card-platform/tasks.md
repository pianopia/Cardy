# 実装計画

- [ ] 1. プロジェクト基盤とコア設定の構築
  - Next.js 14プロジェクトの初期化とTypeScript設定
  - Tailwind CSS、Prisma ORM、NextAuth.jsの設定
  - 基本的なフォルダ構造とコンポーネント階層の作成
  - _要件: 8.1, 8.2_

- [ ] 2. Tursoデータベースとスキーマの実装
  - Tursoデータベースのセットアップと接続設定
  - Prismaスキーマファイルの作成（SQLite/Turso対応）
  - データベーススキーマの作成（users, cards, card_sets, ownership等）
  - Prismaクライアント設定とTurso接続テスト
  - _要件: 4.4, 5.1, 6.4_

- [ ] 3. ユーザー認証システムの実装
  - NextAuth.js設定とプロバイダー（Email/Password）の実装
  - ユーザー登録・ログイン・ログアウト機能の実装
  - 認証ミドルウェアとセッション管理の実装
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ] 4. 基本的な3Dカード表示コンポーネントの実装
  - Three.js、React Three Fiberのセットアップ
  - シンプルなカード3Dモデル（プレーンジオメトリ）の作成
  - カードの回転・インタラクション機能の実装
  - パフォーマンス最適化（オブジェクトプール、視錐台カリング）の実装
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 5. ファイルアップロード機能の実装
  - Next.js API Routesでのファイルアップロード処理
  - 画像形式検証とファイルサイズ制限の実装
  - 画像最適化（リサイズ・圧縮）機能の実装
  - ローカルストレージまたはクラウドストレージ連携
  - _要件: 2.2, 2.3, 2.5_

- [ ] 6. カード作成機能の実装
- [ ] 6.1 カード作成フォームUIの実装
  - React Hook Formを使用したカード作成フォーム
  - 表面・裏面画像アップロード機能
  - バリデーション機能（名前、説明、価格、配布数）
  - _要件: 2.1, 2.2, 2.3_

- [ ] 6.2 カード作成APIエンドポイントの実装
  - POST /api/cardsエンドポイントの実装
  - カードデータの保存とバリデーション
  - 作成者権限の確認とデータベース保存
  - _要件: 2.2, 2.3, 5.1_

- [ ] 6.3 カード作成完了時の3Dプレビュー機能
  - 作成されたカードの3D表示プレビュー
  - 表面・裏面の画像表示確認
  - プレビューからの編集・公開機能
  - _要件: 2.4_

- [ ] 7. カード一覧・詳細表示機能の実装
- [ ] 7.1 カード一覧ページの実装
  - カード一覧取得API（GET /api/cards）の実装
  - 仮想スクロールによる大量カード表示の最適化
  - フィルタリング・ソート機能（価格、希少度、カテゴリ）
  - _要件: 5.2, 5.5_

- [ ] 7.2 カード詳細ページの実装
  - 個別カード詳細取得API（GET /api/cards/:id）の実装
  - 3Dカード表示と詳細情報の表示
  - 希少価値情報（総発行数、残り数、所有者数）の表示
  - _要件: 1.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 8. カードセット機能の実装
- [ ] 8.1 セット作成機能の実装
  - セット作成フォームとUI
  - 複数カードの選択・グループ化機能
  - セット作成API（POST /api/sets）の実装
  - _要件: 6.1, 6.2_

- [ ] 8.2 セット表示・管理機能の実装
  - セット一覧・詳細表示ページ
  - セット内カードの3D表示機能
  - セット在庫管理（販売上限、残り在庫）の実装
  - _要件: 6.4, 6.5_

- [ ] 9. 決済・購入機能の実装
- [ ] 9.1 Stripe決済システムの統合
  - Stripe設定とPayment Intentの実装
  - 決済フォームとクレジットカード入力UI
  - 決済成功・失敗時の処理実装
  - _要件: 3.3, 3.5_

- [ ] 9.2 カード購入機能の実装
  - カード購入API（POST /api/purchase/card/:id）の実装
  - 在庫確認と減算処理
  - 所有権移転とデータベース更新
  - 購入履歴の記録
  - _要件: 3.1, 3.2, 3.3, 3.4, 4.2_

- [ ] 9.3 セット購入機能の実装
  - セット購入API（POST /api/purchase/set/:id）の実装
  - セット内全カードの所有権移転
  - セット在庫管理と売り切れ処理
  - _要件: 6.3, 6.4, 6.6_

- [ ] 10. ユーザーコレクション・ダッシュボード機能の実装
- [ ] 10.1 マイコレクション機能の実装
  - ユーザー所有カード・セット取得API（GET /api/collection）
  - コレクション表示ページとUI
  - 所有カードの3D表示機能
  - _要件: 4.1, 4.3, 7.2_

- [ ] 10.2 マルチロールダッシュボードの実装
  - クリエイター用ダッシュボード（作成したカード・セット）
  - コレクター用ダッシュボード（所有カード・セット）
  - 販売統計とコレクション統計の表示
  - _要件: 7.1, 7.2, 7.4, 7.5_

- [ ] 10.3 自己購入機能の実装
  - 自分が作成したカードの購入許可処理
  - 所有権記録と統計への反映
  - _要件: 7.3_

- [ ] 11. エラーハンドリングとバリデーションの実装
- [ ] 11.1 フロントエンドエラーハンドリング
  - React Error Boundaryの実装
  - API呼び出し失敗時のリトライ機構
  - 3D表示エラー時の2Dフォールバック
  - _要件: 1.4, 2.5_

- [ ] 11.2 バックエンドエラーハンドリング
  - 統一されたAPIエラーレスポンス形式
  - バリデーションエラーの詳細メッセージ
  - 決済失敗時の在庫復元処理
  - _要件: 3.5, 2.5_

- [ ] 12. テストの実装
- [ ] 12.1 フロントエンドテストの実装
  - Jest + React Testing Libraryでのコンポーネントテスト
  - 3Dカード表示コンポーネントのテスト
  - フォーム入力・バリデーションのテスト
  - _要件: 1.1, 1.2, 1.3, 2.1, 2.5_

- [ ] 12.2 バックエンドAPIテストの実装
  - Jest + Supertestでのエンドポイントテスト
  - Tursoデータベース操作のテスト
  - 認証・認可のテスト
  - 決済処理のテスト
  - _要件: 3.3, 4.4, 8.1, 8.2_

- [ ] 13. パフォーマンス最適化の実装
- [ ] 13.1 3D表示パフォーマンス最適化
  - FPS監視とメモリ使用量監視の実装
  - テクスチャ最適化とLOD実装
  - 画面外カードの描画スキップ機能
  - _要件: 1.3_

- [ ] 13.2 UI/UXパフォーマンス最適化
  - 画像遅延読み込みの実装
  - カードリスト仮想化の実装
  - キャッシュ機能の実装
  - _要件: 1.1, 4.1, 5.2_